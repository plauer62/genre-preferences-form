<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Likes / Dislikes Survey</title>
  <style>
    :root{
      --bg:#000;
      --card:#0b0b0b;
      --pill:#cfcfcf;      /* unchecked light gray */
      --like:#49e000;      /* green */
      --dislike:#ff1a1a;   /* red */
      --thumb:#ffffff;     /* white */
      --thumbOff:#6e6e6e;  /* gray (disabled/opposite) */
      --text:#fff;
      --muted:#bdbdbd;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 50% 0%, #111 0%, #000 55%, #000 100%);
      color:var(--text);
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .phone {
      width: 380px;
      max-width: 92vw;
      border-radius: 26px;
      background: linear-gradient(#0a0a0a, #000);
      box-shadow: var(--shadow);
      padding: 18px 16px 16px;
      border: 1px solid rgba(255,255,255,.06);
    }

    h1{
      margin: 6px 0 4px;
      font-size: 18px;
      font-weight: 800;
      text-align:center;
    }
    .sub{
      margin: 0 0 14px;
      text-align:center;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.25;
    }

    .headers{
      display:grid;
      grid-template-columns: 54px 1fr 54px;
      align-items:end;
      padding: 0 4px 8px;
      font-size: 12px;
      font-weight: 800;
      letter-spacing:.06em;
      color: #fff;
      opacity: .9;
    }
    .headers div:nth-child(1){text-align:left}
    .headers div:nth-child(3){text-align:right}

    .list{
      max-height: 520px;
      overflow:auto;
      padding-right: 6px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.25) transparent;
    }
    .list::-webkit-scrollbar{width:8px}
    .list::-webkit-scrollbar-thumb{background:rgba(255,255,255,.18); border-radius:10px}

    .groupLabel{
      margin: 10px 6px 6px;
      font-size: 11px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,.55);
    }

    .row{
      display:grid;
      grid-template-columns: 54px 1fr 54px;
      gap: 10px;
      align-items:center;
      padding: 6px 4px;
    }

    .pill{
      height: 38px;
      border-radius: 999px;
      background: var(--pill);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#111;
      font-weight: 800;
      font-size: 14px;
      letter-spacing:.01em;
      user-select:none;
    }
    .pill.like{ background: var(--like); color:#061b00; }
    .pill.dislike{ background: var(--dislike); color:#240000; }

    .thumbBtn{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .thumbBtn:active{ transform: scale(.98); }
    .thumbBtn[aria-disabled="true"]{
      cursor:not-allowed;
      opacity: .8;
    }

    /* SVG color control */
    .thumbBtn svg{ width: 22px; height: 22px; fill:none; stroke-width:2.2; stroke-linecap:round; stroke-linejoin:round; }
    .thumbBtn .stroke{ stroke: var(--thumb); }

    .thumbBtn.off .stroke{ stroke: var(--thumbOff); }
    .thumbBtn.onLike{
      background: rgba(73,224,0,.15);
      border-color: rgba(73,224,0,.35);
    }
    .thumbBtn.onLike .stroke{ stroke: var(--like); }
    .thumbBtn.onDislike{
      background: rgba(255,26,26,.15);
      border-color: rgba(255,26,26,.35);
    }
    .thumbBtn.onDislike .stroke{ stroke: var(--dislike); }

    .actions{
      margin-top: 14px;
      display:flex;
      justify-content:center;
    }
    .save{
      border:none;
      background:#fff;
      color:#000;
      font-weight: 900;
      letter-spacing:.06em;
      padding: 10px 26px;
      border-radius: 999px;
      cursor:pointer;
    }

    .hint{
      margin: 10px 0 0;
      font-size: 11px;
      color: rgba(255,255,255,.55);
      text-align:center;
      line-height:1.25;
    }

    .output{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      white-space: pre-wrap;
      word-break: break-word;
      color: rgba(255,255,255,.9);
      display:none;
    }
  </style>
</head>

<body>
  <div class="phone" role="application" aria-label="Likes and Dislikes survey">
    <h1>Tell us what you like and dislike…</h1>
    <p class="sub">(this determines what you see on home page)</p>

    <div class="headers">
      <div>LIKE</div>
      <div></div>
      <div>DISLIKE</div>
    </div>

    <div id="list" class="list" aria-live="polite"></div>

    <div class="actions">
      <button id="saveBtn" class="save" type="button">SAVE</button>
    </div>

    <p class="hint">(You can edit Likes/Dislikes at any time in Personalization tab of Settings.)</p>
    <div id="output" class="output"></div>
  </div>

  <script>
    /**
     * States per item:
     *  - "unchecked"
     *  - "like"
     *  - "dislike"
     *
     * Behavior per spec:
     *  - Clicking Like when unchecked => like (row green, dislike thumb gray)
     *  - Clicking Like again => unchecked (row gray, both thumbs white)
     *  - Clicking Dislike when unchecked => dislike (row red, like thumb gray)
     *  - Clicking Dislike again => unchecked
     *  - Clicking opposite thumb flips state and moves groups
     *  - Items immediately rearrange into: liked (top), disliked (middle), unchecked (bottom)
     */

    const GENRES = [
      "Family",
      "Horror",
      "Action Adventure",
      "Romance",
      "Crime",
      "Documentary",
      "Animation",
      "Comedy",
      "Reality TV",
      "Game Shows",
      "Sci-Fi",
      "Thriller",
      "Drama",
      "Mystery",
      "Fantasy",
      "Musical"
    ];

    const STORAGE_KEY = "likesDislikesPreferences_v1";

    /** Load existing prefs (for “can be edited/updated at any time”) */
    const saved = (() => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "null"); }
      catch { return null; }
    })();

    // Internal model: { id, label, state, originalIndex }
    let items = GENRES.map((label, i) => ({
      id: "g" + i,
      label,
      state: (saved && saved.states && saved.states[label]) || "unchecked",
      originalIndex: i
    }));

    const listEl = document.getElementById("list");
    const outputEl = document.getElementById("output");
    const saveBtn = document.getElementById("saveBtn");

    function sortItems(arr){
      const order = { like: 0, dislike: 1, unchecked: 2 };
      // Stable-ish: within group, keep original order
      return [...arr].sort((a,b) => {
        const d = order[a.state] - order[b.state];
        if (d !== 0) return d;
        return a.originalIndex - b.originalIndex;
      });
    }

    function groupLabelFor(state){
      if (state === "like") return "Liked";
      if (state === "dislike") return "Disliked";
      return "Unchecked";
    }

    function thumbSVG(){
      // Simple thumb icon (outline)
      return `
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path class="stroke" d="M14 10V5.5c0-1.2-1-2.2-2.2-2.2H11L7.8 10.2c-.3.6-.4 1.2-.2 1.8l.9 2.9c.2.6.8 1.1 1.5 1.1H16c.8 0 1.5-.5 1.7-1.3l1.1-4.4c.2-.9-.4-1.8-1.3-2H14z"/>
          <path class="stroke" d="M6 10v8"/>
        </svg>
      `;
    }

    function render(){
      const sorted = sortItems(items);

      // Build grouped sections
      const groups = { like: [], dislike: [], unchecked: [] };
      for (const it of sorted) groups[it.state].push(it);

      const sections = ["like","dislike","unchecked"]
        .filter(k => groups[k].length > 0)
        .map(k => {
          const rows = groups[k].map(it => rowHTML(it)).join("");
          return `
            <div class="groupLabel">${groupLabelFor(k)}</div>
            ${rows}
          `;
        }).join("");

      listEl.innerHTML = sections;

      // Attach event handlers
      for (const it of items){
        const likeBtn = document.getElementById(`like-${it.id}`);
        const dislikeBtn = document.getElementById(`dislike-${it.id}`);

        if (likeBtn) likeBtn.onclick = () => toggle(it.id, "like");
        if (dislikeBtn) dislikeBtn.onclick = () => toggle(it.id, "dislike");
      }
    }

    function rowHTML(it){
      const isLike = it.state === "like";
      const isDislike = it.state === "dislike";

      // Opposite thumb turns gray when selected (per spec)
      const likeClass =
        isLike ? "thumbBtn onLike" : (isDislike ? "thumbBtn off" : "thumbBtn");
      const dislikeClass =
        isDislike ? "thumbBtn onDislike" : (isLike ? "thumbBtn off" : "thumbBtn");

      const pillClass = isLike ? "pill like" : (isDislike ? "pill dislike" : "pill");

      // aria-disabled is visual; we still allow clicking to flip state
      const likeAriaDisabled = "false";
      const dislikeAriaDisabled = "false";

      return `
        <div class="row" data-state="${it.state}">
          <button
            id="like-${it.id}"
            class="${likeClass}"
            type="button"
            aria-label="Like ${it.label}"
            aria-disabled="${likeAriaDisabled}"
          >${thumbSVG()}</button>

          <div class="${pillClass}" role="button" tabindex="0" aria-label="${it.label}">
            ${it.label}
          </div>

          <button
            id="dislike-${it.id}"
            class="${dislikeClass}"
            type="button"
            aria-label="Dislike ${it.label}"
            aria-disabled="${dislikeAriaDisabled}"
          >${thumbSVG().replace('viewBox="0 0 24 24"', 'viewBox="0 0 24 24" style="transform: rotate(180deg)"')}</button>
        </div>
      `;
    }

    function toggle(itemId, action){
      const it = items.find(x => x.id === itemId);
      if (!it) return;

      if (action === "like"){
        // Clicking like again resets to unchecked; clicking from dislike flips to like
        it.state = (it.state === "like") ? "unchecked" : "like";
      } else {
        it.state = (it.state === "dislike") ? "unchecked" : "dislike";
      }

      // Immediate rearrange after each selection (per spec)
      render();
    }

    function buildPayload(){
      const liked = items.filter(i => i.state === "like").map(i => i.label);
      const disliked = items.filter(i => i.state === "dislike").map(i => i.label);
      const unchecked = items.filter(i => i.state === "unchecked").map(i => i.label);

      // Also store lookup by label for easy re-hydration
      const states = {};
      for (const it of items) states[it.label] = it.state;

      return {
        version: 1,
        updatedAt: new Date().toISOString(),
        liked,
        disliked,
        unchecked,
        states
      };
    }

    saveBtn.addEventListener("click", () => {
      const payload = buildPayload();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      outputEl.style.display = "block";
      outputEl.textContent = JSON.stringify(payload, null, 2);
    });

    // Initial render
    render();
  </script>
</body>
</html>
